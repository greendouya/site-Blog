<?xml version='1.0' encoding='UTF-8'?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN"><id>https://blog.wooocloud.com/</id><title>稳妥国字脸</title><updated>2020-01-16T06:29:59.802865+08:06</updated><author><name>Dragon</name><email>gotspinach@foxmail.com</email></author><link href="https://blog.wooocloud.com/" rel="alternate"/><generator uri="http://lkiesow.github.io/python-feedgen" version="0.8.0">python-feedgen</generator><logo>https://cdn.jsdelivr.net/gh/greendouya/site-Blog@gh-pages/android-chrome-512x512.png</logo><subtitle>7.24也算个节日了么?</subtitle><entry><id>https://blog.wooocloud.com/archives/first-blog/</id><title>First Blog</title><updated>2020-01-16T06:29:59.803073+00:00</updated><author><name>Dragon</name><email>gotspinach@foxmail.com</email><uri>http://blog.wooocloud.com</uri></author><content>&lt;p&gt;这是第一篇博客
感谢&lt;code&gt;Maverick&lt;/code&gt; &amp;amp; &lt;code&gt;Galileo&lt;/code&gt;
感谢&lt;a href="https://github.com/AlanDecode"&gt;AlanDecode&lt;/a&gt;&lt;/p&gt;
</content><link href="https://blog.wooocloud.com/archives/first-blog/" rel="alternate"/><published>2020-01-16T09:00:00+08:06</published></entry><entry><id>https://blog.wooocloud.com/archives/vim-modify-save/</id><title>vim自动备份修改之前的文件</title><updated>2020-01-16T06:29:59.803033+00:00</updated><author><name>Dragon</name><email>gotspinach@foxmail.com</email><uri>http://blog.wooocloud.com</uri></author><content>&lt;p&gt;vim ~/.vimrc&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;set backup
function Bkdir()
    let $BKODIR=expand("$HOME/.vim/backup")
    let $RUNTIMEPATH=expand("%:p:h")
    let $BKDIR=$BKODIR.$RUNTIMEPATH
    if !isdirectory(expand("$BKDIR"))
        call mkdir(expand("$BKDIR"),"p",0750)
    endif
endfunction
au BufWrite * call Bkdir()
autocmd BufWritePre * let &amp;amp;bex = '_'.strftime("%Y%m%d_%H_%M_%S")
let &amp;amp;backupdir=expand("$HOME/.vim/backup").expand("%:p:h")&lt;/code&gt;&lt;/pre&gt;
</content><link href="https://blog.wooocloud.com/archives/vim-modify-save/" rel="alternate"/><published>2020-01-16T12:00:00+08:06</published></entry><entry><id>https://blog.wooocloud.com/archives/openvpn-in-centos7/</id><title>CentOS7部署openvpn</title><updated>2020-01-16T06:29:59.802915+00:00</updated><author><name>Dragon</name><email>gotspinach@foxmail.com</email><uri>http://blog.wooocloud.com</uri></author><content>&lt;ol&gt;
&lt;li&gt;&lt;p&gt;安装软件包&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;yum install -y epel-release
yum install -y openvpn easy-rsa openssl openssl-devel lzo lzo-devel pam pam-devel automake pkgconfig&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;server端 制作证书，密钥等文件
```
# 复制服务端配置文件至openvpn的根目录
cp /usr/share/doc/openvpn-2.4.8/sample/sample-config-files/server.conf /etc/openvpn/&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;创建制作证书目录&lt;/h1&gt;
&lt;p&gt;mkdir /etc/openvpn/easy-rsa&lt;/p&gt;
&lt;p&gt;cd /etc/openvpn/&lt;/p&gt;
&lt;h1&gt;复制制作证书工具至制作证书目录&lt;/h1&gt;
&lt;p&gt;cp -r /usr/share/easy-rsa/3.0.6/* /etc/openvpn/easy-rsa/&lt;/p&gt;
&lt;p&gt;cd easy-rsa/&lt;/p&gt;
&lt;h1&gt;创建证书配置信息&lt;/h1&gt;
&lt;p&gt;vim vars
set_var EASYRSA_REQ_COUNTRY     "CN"        # 国家
set_var EASYRSA_REQ_PROVINCE    "HB"        # 省份
set_var EASYRSA_REQ_CITY        "Wuhan"     # 城市
set_var EASYRSA_REQ_ORG         "dragon"    # 组织
set_var EASYRSA_REQ_EMAIL       "xx@xx.com" # 邮箱
set_var EASYRSA_REQ_OU          "dragon"    # 拥有者&lt;/p&gt;
&lt;h1&gt;初始化pki，生成目录文件结构&lt;/h1&gt;
&lt;p&gt;./easyrsa init-pki
init-pki complete; you may now create a CA or requests.
your newly created PKI dir is: /etc/openvpn/easy-rsa/pki&lt;/p&gt;
&lt;h1&gt;使用vars文件里面配置的信息创建ca证书,中间会提示输入密码,记住此密码,后期需要使用&lt;/h1&gt;
&lt;p&gt;./easyrsa build-ca
Note: using Easy-RSA configuration from: ./vars                                  #使用vars文件里面配置的信息
Generating a 2048 bit RSA private key
.................+++
........................................................................................+++
writing new private key to '/etc/openvpn/easy-rsa/pki/private/ca.key.Lg8IKADc4Q'
Enter PEM pass phrase:                                                                      # 设置ca密码&lt;/p&gt;
&lt;h2&gt;Verifying - Enter PEM pass phrase:                                                     # 重新输入上面的密码&lt;/h2&gt;
&lt;p&gt;You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,&lt;/p&gt;
&lt;h2&gt;If you enter '.', the field will be left blank.&lt;/h2&gt;
&lt;p&gt;Common Name (eg: your user, host, or server name) [Easy-RSA CA]:         # 直接回车，就是默认的CA作为名字,也可自自定义,本次使用opserver
CA creation complete and you may now import and sign cert requests.
Your new CA certificate file for publishing is at:
/etc/openvpn/easy-rsa/pki/ca.crt&lt;/p&gt;
&lt;h1&gt;nopass设置免证书密码，如果要设置密码可以取消此参数选项,设置CommonName的时候可使用默认的server,也可自定义.&lt;/h1&gt;
&lt;p&gt;./easyrsa gen-req opserver nopass
Note: using Easy-RSA configuration from: ./vars                             #使用vars文件里面配置的信息
Generating a 2048 bit RSA private key
.....................................+++
................................................................................................+++&lt;/p&gt;
&lt;h2&gt;writing new private key to '/etc/openvpn/easy-rsa/pki/private/opserver.key.yuG9HRsSlU'&lt;/h2&gt;
&lt;p&gt;You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,&lt;/p&gt;
&lt;h2&gt;If you enter '.', the field will be left blank.&lt;/h2&gt;
&lt;p&gt;Common Name (eg: your user, host, or server name) [server]:                     #直接回车，默认名字为server,也可自定义,本次使用opserver
Keypair and certificate request completed. Your files are:
req: /etc/openvpn/easy-rsa/pki/reqs/opserver.req
key: /etc/openvpn/easy-rsa/pki/private/opserver.key&lt;/p&gt;
&lt;h1&gt;第二个server是只上面服务端证书的CommonName名字，本次使用opserver&lt;/h1&gt;
&lt;p&gt;./easyrsa sign server opserver
You are about to sign the following certificate.
Please check over the details shown below for accuracy. Note that this request
has not been cryptographically verified. Please be sure it came from a trusted
source or that you have verified the request checksum with the sender.&lt;/p&gt;
&lt;p&gt;Request subject, to be signed as a server certificate for 3650 days:&lt;/p&gt;
&lt;p&gt;subject=
    commonName                = opserver&lt;/p&gt;
&lt;p&gt;Type the word 'yes' to continue, or any other input to abort.
  Confirm request details: yes
Using configuration from ./openssl-1.0.cnf
Enter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:            #输入上面ca证书生成时的密码
Check that the request matches the signature
Signature ok
The Subject's Distinguished Name is as follows
commonName            :PRINTABLE:'opserver'
Certificate is to be certified until Jan 14 09:11:12 2029 GMT (3650 days)
Write out database with 1 new entries
Data Base Updated
Certificate created at: /etc/openvpn/easy-rsa/pki/issued/opserver.crt          #服务端证书路径&lt;/p&gt;
&lt;h1&gt;创建Diffie-Hellman，时间有点长&lt;/h1&gt;
&lt;p&gt;./easyrsa gen-dh
Note: using Easy-RSA configuration from: ./vars
Generating DH parameters, 2048 bit long safe prime, generator 2
This is going to take a long time
............................................................+...........................................................+.......................................................................................................+...........+..........................................................................................................................................................................................................................................................................+..........................................
DH parameters of size 2048 created at /etc/openvpn/pki/dh.pem                 #dh证书路径&lt;/p&gt;
&lt;p&gt;cd /etc/openvpn&lt;/p&gt;
&lt;h1&gt;生成ta.key&lt;/h1&gt;
&lt;p&gt;openvpn --genkey --secret ta.key&lt;/p&gt;
&lt;h1&gt;客户端证书&lt;/h1&gt;
&lt;h1&gt;为了便于区别，我们把客户端使用的证书存放在新的路径。/etc/openvpn/client,证书制作流程如server&lt;/h1&gt;
&lt;p&gt;mkdir -p /etc/openvpn/client&lt;/p&gt;
&lt;p&gt;cd /etc/openvpn/client&lt;/p&gt;
&lt;p&gt;cp -r /usr/share/easy-rsa/3.0.6/* /etc/openvpn/client&lt;/p&gt;
&lt;p&gt;cp /usr/share/doc/easy-rsa-3.0.6/vars.example ./vars&lt;/p&gt;
&lt;p&gt;./easyrsa init-pki&lt;/p&gt;
&lt;p&gt;./easyrsa gen-req opclient nopass&lt;/p&gt;
&lt;p&gt;cd /etc/openvpn/easy-rsa&lt;/p&gt;
&lt;p&gt;./easyrsa import-req /etc/openvpn/client/pki/reqs/opclient.req opclient&lt;/p&gt;
&lt;p&gt;./easyrsa sign client opclient&lt;/p&gt;
&lt;h1&gt;将制作好的server证书放在openvpn的根目录,方便配置文件读取&lt;/h1&gt;
&lt;p&gt;cp /etc/openvpn/easy-rsa/pki/ca.crt /etc/openvpn/
cp /etc/openvpn/easy-rsa/pki/private/opserver.key /etc/openvpn/
cp /etc/openvpn/easy-rsa/pki/issued/opserver.crt /etc/openvpn/
cp /etc/openvpn/easy-rsa/pki/dh.pem /etc/openvpn/&lt;/p&gt;
&lt;p&gt;cd /etc/openvpn/&lt;/p&gt;
&lt;h1&gt;server配置文件&lt;/h1&gt;
&lt;p&gt;vim server.conf
cat /etc/openvpn/server.conf
local 0.0.0.0
port 1194
proto tcp
dev tun
ca ca.crt
cert opserver.crt
key opserver.key
dh dh.pem
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt
push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 8.8.8.8"
push "dhcp-option DNS 114.114.114.114"
keepalive 10 120
tls-auth ta.key 0
cipher AES-256-CBC
comp-lzo
persist-key
persist-tun
status openvpn-status.log
verb 3&lt;/p&gt;
&lt;h1&gt;启动openvpn-server并开机启动&lt;/h1&gt;
&lt;p&gt;systemctl -f enable openvpn@server.service
systemctl start openvpn@server.service&lt;/p&gt;
&lt;h1&gt;下载客户端证书至本地&lt;/h1&gt;
&lt;p&gt;sz /etc/openvpn/easy-rsa/pki/issued/client.crt
sz /etc/openvpn/client/pki/private/client.key
sz /etc/openvpn/easy-rsa/pki/ca.crt
sz /etc/openvpn/ta.key&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
3. 开启OpenVPN服务器的网卡转发功能&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;echo "net.ipv4.ip_forward = 1" &amp;gt;&amp;gt;/etc/sysctl.conf
sysctl -p&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
4. 添加nat规则并生效&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o enp0s31f6 -j MASQUERADE
iptables-save&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
5. 客户端配置文件client.opvn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;client
dev tun&lt;br&gt;
proto tcp
remote server端IP 1194
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
ca ca.crt
cert opclient.crt
key opclient.key
tls-auth ta.key 1
cipher AES-256-CBC
comp-lzo
verb 3&lt;br&gt;
```&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;将下载到本地的客户端证书和客户端配置文件拷贝至openvpn目录的config目录中&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;启动&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;参考: &lt;a href="https://segmentfault.com/a/1190000019502850"&gt;Centos7 安装openvpn by easy-rsa3.0&lt;/a&gt; 操作整理&lt;/h1&gt;
</content><link href="https://blog.wooocloud.com/archives/openvpn-in-centos7/" rel="alternate"/><published>2020-01-16T12:00:00+08:06</published></entry></feed>